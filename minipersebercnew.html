<!doctype html><html lang="fr"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"><title>Studio Berecllo — By S.B</title><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://drive.google.com"><link rel="preconnect" href="https://content.googleapis.com"><link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 64 64'%3E%3Crect rx='12' ry='12' width='64' height='64' fill='%23000'/%3E%3Ctext x='50%25' y='54%25' dominant-baseline='middle' text-anchor='middle' fill='%23fff' font-family='Helvetica Neue' font-size='28' font-weight='300'%3EB%3C/text%3E%3C/svg%3E"><link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;600&display=swap" rel="stylesheet"><link href="https://fonts.googleapis.com/css2?family=Cinzel:wght@400;500&display=swap" rel="stylesheet"><style>:root{--headerH:95px;--border:#e6e8ee}*{box-sizing:border-box}body{margin:0;background:#f6f7fa;color:#111;font:15px/1.6 "Helvetica Neue",Helvetica,Arial,sans-serif}.header-wrap{position:fixed;inset:0 0 auto 0;height:var(--headerH);background:radial-gradient(circle at 20% 20%,#fff 0%,#f9f9f9 60%,#f0f0f0 100%);border-bottom:1px solid rgba(224,192,102,.55);display:flex;align-items:center;justify-content:space-between;padding:0 24px;z-index:100;box-shadow:0 12px 32px rgba(0,0,0,.15)}.brand{display:flex;align-items:center;height:100%}.brand a{display:flex;align-items:center;height:100%;text-decoration:none}.brand svg{height:100px;width:auto;display:block}.headerTexts{text-align:right;color:#000}.title{font-family:'Cinzel',serif;font-weight:400;font-size:22px;line-height:1.1;margin:0}.subTitleSmall{font-size:12px;font-weight:500;color:#6b6b6b;letter-spacing:.08em;text-transform:uppercase;margin:4px 0 0 0}.page{padding-top:calc(var(--headerH) + 10px);padding-bottom:60px}.wrap{max-width:2000px;margin:0 40px;padding:0 24px}.grid{display:grid;grid-template-columns:minmax(0,2.1fr) minmax(0,1.2fr);gap:24px;align-items:flex-start}@media(max-width:1200px){.grid{grid-template-columns:1fr}}.signature{position:fixed;left:64px;bottom:1px;font:500 12px/1.4 "Helvetica Neue",Arial,sans-serif;color:#6b6b6b;background:rgba(255,255,255,.7);border:1px solid rgba(0,0,0,.08);border-radius:10px;box-shadow:0 8px 20px rgba(0,0,0,.08);backdrop-filter:blur(6px);padding:10px 14px;z-index:9999;text-align:left;max-width:240px}.signature .legal{margin-top:6px;font-size:11px;color:#7a7a7a}.card{background:#fff;border:1px solid var(--border);border-radius:20px;box-shadow:0 12px 30px rgba(0,0,0,.06);display:flex;flex-direction:column}.viewer{position:relative;aspect-ratio:2048/1265;width:100%;border-radius:20px 20px 0 0;overflow:hidden;background:#eef2f7;display:flex;align-items:center;justify-content:center;touch-action:none}#cvWrap{position:relative;width:100%;height:100%;transform-origin:center center;display:flex;align-items:center;justify-content:center}canvas#cv{width:100%;height:100%;display:block;background:#eef2f7}.model-label{position:absolute;left:50%;bottom:20px;transform:translate(-50%);padding:12px 18px;border-radius:14px;background:rgba(255,255,255,.96);border:1px solid rgba(0,0,0,.1);backdrop-filter:blur(6px);font:300 21px/1.2 "Helvetica Neue",sans-serif;letter-spacing:.12em;color:#0b0d10;box-shadow:0 10px 24px rgba(0,0,0,.12);white-space:nowrap;max-width:90%;overflow:hidden;text-overflow:ellipsis;text-align:center}.loader-overlay{position:absolute;right:20px;top:20px;width:30px;height:30px;background:rgba(255,255,255,.9);border-radius:50%;box-shadow:0 2px 10px rgba(0,0,0,.1);display:flex;align-items:center;justify-content:center;opacity:0;pointer-events:none;transition:opacity .2s;z-index:10}.loader-overlay.active{opacity:1}.spinner{width:16px;height:16px;border:2px solid #e1e1e1;border-top:2px solid #c79b3f;border-radius:50%;animation:spin .8s linear infinite}@keyframes spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}.toolbar{border-top:1px solid var(--border);padding:16px 20px;display:flex;justify-content:flex-end;gap:12px;flex-wrap:wrap}.btn3d{cursor:pointer;border:0;border-radius:12px;padding:12px 18px;font:600 15px/1.1 "Helvetica Neue",sans-serif;color:#111;background:#fff;position:relative;isolation:isolate;box-shadow:inset 0 1px 0 rgba(255,255,255,.9),0 6px 16px rgba(0,0,0,.08);transition:transform .1s,box-shadow .15s}.btn3d::before{content:'';position:absolute;inset:0;border-radius:12px;padding:2px;background:conic-gradient(from 210deg,#dfe7f4,#a8b9d0,#6f87a6,#e9f0fb,#8aa3c7,#dfe7f4);-webkit-mask:linear-gradient(#000 0 0) content-box,linear-gradient(#000 0 0);-webkit-mask-composite:xor;mask-composite:exclude;pointer-events:none}.btn3d:hover{transform:translateY(-1px);box-shadow:0 10px 26px rgba(0,0,0,.15)}.side{display:flex;flex-direction:column;gap:16px;max-height:calc(100vh - var(--headerH) - 40px);overflow-y:auto;padding-right:4px}.panel{background:#fff;border:1px solid var(--border);border-radius:18px;padding:16px 16px 20px;box-shadow:0 12px 30px rgba(0,0,0,.06)}.panelHeader{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}.panelHeader h2{margin:0;font:600 18px/1 'Montserrat',sans-serif;color:#111}.gal{display:grid;grid-template-columns:repeat(5,minmax(0,1fr));gap:10px}@media(min-width:1400px){.gal{grid-template-columns:repeat(5,1fr)}}@media(max-width:600px){.gal{grid-template-columns:repeat(2,1fr)}}.thumb{position:relative;width:100%;aspect-ratio:1/1;border-radius:14px;background:radial-gradient(circle at 0 0,#fff,#e2e8f0);box-shadow:0 10px 20px rgba(148,163,184,.55),0 0 0 1px rgba(148,163,184,.3) inset;overflow:hidden;cursor:pointer;transition:transform .16s,filter .16s;display:flex;align-items:center;justify-content:center}.thumb:hover{transform:translateY(-2px);filter:brightness(1.05)}.thumbImg{position:absolute;inset:0;background-size:cover;background-position:center;background-repeat:no-repeat}.thumbLabel{position:absolute;left:3px;bottom:3px;right:1px;font:600 14px/1.3 'Montserrat',sans-serif;letter-spacing:.06em;text-align:left;z-index:2;text-shadow:0 2px 4px rgba(0,0,0,.6);color:#000}.thumbClose{position:absolute;top:8px;right:8px;width:16px;height:16px;border-radius:4px;background:rgba(0,0,0,.55);color:#fff;font-size:10px;line-height:16px;text-align:center;font-weight:600;cursor:pointer;z-index:3;box-shadow:0 2px 4px rgba(0,0,0,.45)}.thumb[aria-selected="true"]{transform:translateY(-2px)}.thumb[aria-selected="true"]::before{content:'';position:absolute;z-index:2;inset:-5px;border-radius:18px;padding:9px;background:conic-gradient(from 210deg,#fff9df,#f4e0a1,#e2c369,#c79b3f,#eacf86,#f7e9b7,#fff9df);-webkit-mask:linear-gradient(#000 0 0) content-box,linear-gradient(#000 0 0);-webkit-mask-composite:xor;mask-composite:exclude;box-shadow:0 0 0 2px rgba(199,155,63,.95) inset,0 10px 22px rgba(184,148,62,.45);pointer-events:none}.thumb[aria-selected="true"]::after{content:'';position:absolute;z-index:1;inset:0;border-radius:12px;background:radial-gradient(120% 60% at 15% 0%,rgba(255,255,255,.38) 0%,rgba(255,255,255,0) 60%);box-shadow:inset 0 0 0 3px rgba(224,192,102,.95);pointer-events:none}.thumb[aria-selected="true"] .thumbImg{filter:saturate(1.08) contrast(1.06)}@media (prefers-reduced-motion:no-preference){.thumb[aria-selected="true"]::before{animation:goldSheen 3s linear infinite}@keyframes goldSheen{0%{filter:hue-rotate(0deg) brightness(1)}50%{filter:hue-rotate(-8deg) brightness(1.06)}100%{filter:hue-rotate(0deg) brightness(1)}}}.note{margin:10px 0 20px 20px;font:600 12px 'Montserrat',sans-serif;color:#8a8f9a;visibility:hidden}.toast{position:fixed;left:50%;bottom:40px;transform:translateX(-50%);background:rgba(255,255,255,.95);border:1px solid rgba(0,0,0,.1);border-radius:12px;padding:12px 22px;font:600 15px 'Montserrat',sans-serif;color:#000;box-shadow:0 4px 20px rgba(0,0,0,.15);opacity:0;pointer-events:none;transition:opacity .4s;z-index:9999}.toast.show{opacity:1}@media (max-width:1024px){.header-wrap{position:static;height:auto;padding:10px 16px;flex-wrap:wrap;row-gap:8px}.page{padding-top:24px}.grid{grid-template-columns:1fr;gap:24px}.signature{bottom:10px}}@media (max-width:640px){body{font-size:14px}.brand svg{height:48px}.headerTexts{text-align:left;margin-top:6px}.title{font-size:18px}.toolbar{flex-direction:column;align-items:stretch}.signature{left:50%;transform:translateX(-50%);max-width:calc(100% - 20px);text-align:center}}</style></head><body><header class="header-wrap"><div class="brand"><a href="https://berecllo.fr/berecllo-lunettes-montures-engagees/espace-revendeurs/" target="_blank" rel="noopener noreferrer" aria-label="Berecllo – Espace revendeurs">
<svg xmlns="http://www.w3.org/2000/svg" id="Calque_1" version="1.1" viewBox="0 0 460 273.7">
<defs><style>.st0 { fill: #242422; }</style></defs>
<g>
<path class="st0" d="M172.1,114.2c-9.5,0-17.7,5.6-24.5,16.9-6.1,9.9-9.1,19.9-9.1,29.9s.9,8.6,2.6,10.8c1.8,2.2,4.3,3.4,7.6,3.4,11.1,0,28.3-15,29.5-16.3,1.1-1.3.9-2.3.4-2.9-.5-.6-1.7-.8-2.7-.2-1,.7-10.5,7.4-13.5,8.8-2.3,1.1-4.4,1.6-6.3,1.6s-3.5-.7-4.6-2c-1.1-1.3-1.6-3.6-1.6-6.9s.2-4.7.6-7.2c8.9-4,14.7-6.8,17.4-8.3,5.4-3.2,9.2-6.2,11.3-9.2,2.1-2.9,3.2-5.9,3.2-9s-.9-5.2-2.6-6.8c-1.8-1.7-4.3-2.5-7.6-2.5ZM168.3,134.7c-3.8,3.9-9.4,7.5-17,10.9.9-5.3,2.4-10.6,4.6-15.7,1.5-3.5,3.3-6.1,5.5-7.9,1.6-1.3,3.3-2,5.1-2s3.1.6,4.1,1.8c1.1,1.2,1.6,2.8,1.6,4.8s-1.3,5.4-3.9,8.1Z"/>
<path class="st0" d="M236.7,120.5c.9-.9,1.4-2,1.4-3.2s-.5-2.3-1.4-3.2c-.9-.9-2.1-1.4-3.5-1.4s-4.3,1.3-7.2,3.8c-6,5.3-11.3,11.7-16,19.1l3-12.6c.6-2.6.9-4.2.9-4.9s-.2-1.1-.7-1.5c-.5-.4-1.2-.6-2-.6-2.4,0-5.8,1.3-10.3,3.6-4.9,2.6-11.9,9.2-12.5,10-.7.9-.5,1.6.1,2,.6.5,1.7.4,2.3-.1.7-.5,5.2-4.8,6.7-5.8,1.4-1,2.5-1.4,3.2-1.4,1,0,1.5.6,1.5,1.7s-.2,1.8-.6,3.9c-1.8,8.3-3.9,17.1-6.2,26.4l-4.9,18.9h10.4l3.2-13.6c2.1-9.1,3.7-14.9,4.7-17.4,1-2.5,2.8-5.4,5.4-8.8,2.6-3.4,5-5.9,7.1-7.5,2.2-1.6,5-3,8.4-4.2,3.6-1.2,5.9-2.3,6.8-3.2Z"/>
<path class="st0" d="M321.6,116.2c-1.8-1.3-4.4-2-7.9-2-5.5,0-10.5,1.6-14.9,4.8-5.6,4.2-10.4,10.1-14.3,18-3.9,7.8-5.9,15.4-5.9,22.8s.9,8.1,2.8,11c1.8,2.9,4.8,4.4,8.9,4.3,12.1-.1,26.6-13,28.4-14.6,1.9-1.7,1.6-3.3,1.2-3.8-.5-.7-1.8-1.1-2.8-.5-2.1,1.3-14.2,11.3-19.7,11.3s-4.1-.9-5.3-2.8c-1.7-2.4-2.6-5.9-2.6-10.3s1-12,3.1-18c2.1-6,4.2-10,6.5-12.1,2.3-2.1,4.5-3.1,6.8-3.1s4,.8,6.7,2.4c2.6,1.5,4.7,2.2,6.3,2.2s3-.5,3.9-1.4c.9-.9,1.4-2.1,1.4-3.5s-.9-3.5-2.7-4.8Z"/>
<path class="st0" d="M437.9,119.6c-3-3.6-6.9-5.5-11.4-5.5-10.5,0-19.3,5.2-26.4,15.5-5.6,8.3-8.4,17.4-8.4,27.2s.2,3.4.5,5c-7.2,3.6-12.6,5.2-17.5,6-2.3.4-2-2.1-1.6-4,.1-.7,2-9.5,5.9-26.3l8-33.5c2.8-12,4.8-20.1,6.1-24.2,1.3-4.1,2.6-6.8,4.2-8,1.1-.9,2.8-1.4,4.9-1.4s8.9,1.1,10.7,1.1c2.9,0,7.3-2.5,7.3-7.1s-3.9-7.5-7.7-7.5c-6.7,0-9.4,5.2-15.5,8.8-6,3.6-10.7,8.7-14,15.2-2.1,4.3-4.8,12.8-7.9,25.5l-8.6,35.1c-1.8,7.5-3.2,13.5-4,18.1-9.3,5.2-15.7,7.1-21.5,8.1-2.3.4-2-2.1-1.6-4,.1-.7,2-9.5,5.9-26.3l8-33.5c2.8-12,4.8-20.1,6.1-24.2,1.2-4.1,2.6-6.8,4.2-8,1.1-.9,2.8-1.4,4.9-1.4s8.9,1.1,10.7,1.1c2.9,0,7.3-2.5,7.3-7.1s-3.9-7.5-7.7-7.5c-6.7,0-9.4,5.2-15.5,8.8-6,3.6-10.7,8.7-14,15.2-2.1,4.3-4.8,12.8-7.9,25.5l-8.6,35.1c-3.3,13.4-5,22.3-5,26.5s.5,3.9,1.6,5.2c1.1,1.3,2.4,1.9,4.1,1.9,9.9,0,20.9-5.7,28.1-9.6,0,1-.1,1.9-.1,2.6,0,2.2.5,3.9,1.6,5.2,1.1,1.3,2.4,1.9,4.1,1.9,9.2,0,19.3-4.9,26.5-8.7.7,1.4,1.6,2.7,2.6,3.8,3.1,3.3,7.1,4.9,12.1,4.9,8.1,0,15.9-4.1,23.1-12.4,7.3-8.2,10.9-17.6,10.9-27.9s-1.5-11.6-4.6-15.2ZM424.3,162.4c-3.2,4.9-6.8,7.3-10.7,7.3s-5-1.3-6.7-3.9c-2.3-3.5-3.4-8.3-3.4-14.4,0-10,1.9-17.8,5.6-23.5,3.7-5.7,7.6-8.5,11.5-8.5s5.2,1.5,7.1,4.5c1.9,3,2.8,8,2.8,15s-2.1,17.2-6.2,23.5Z"/>
<path class="st0" d="M129.2,96.6c4.1-5.2,6.2-10.9,6.2-17.2s-1.9-9.8-5.6-13.7c-1.3-1.2-1.8-1.9-5.1-4.3-6-3.9-14.4-5.8-25.1-5.8s-27.6,3.1-39.6,9.3c-12,6.2-21.2,14.4-27.8,24.7-6.5,10.3-9.8,20.9-9.8,31.8s1.9,14.6,5.7,20c3.8,5.4,5.1,8.7,9.3,9,2.8.2,7.6-2.1,7.6-6.8,0-2.8-.9-6.6-6.7-7.8-2.4-.5-4.8-2.8-5.5-3.9-1.3-1.8-2.3-3.7-3-5.8-.7-2.1-1-4.4-1-6.9,0-9.1,3-18.1,8.9-27.1,6-9,14.3-16.3,24.9-22,10.7-5.6,21.9-8.4,33.7-8.4s14.6,1.7,18.8,5.1c4.2,3.4,6.3,7.9,6.3,13.4,0,7.9-2.9,14.8-8.7,20.6-5.8,5.8-14.5,8.7-26,8.7l5.7-22.2c1.6-5.5,2.2-8.2,4.5-15.8-9.3,1.5-16.4,2.6-24,3.9l-1.2,4.8c.8-.2,1.4-.3,2-.3,1.2,0,2.3.4,3.1,1.1.8.8,1.2,1.6,1.2,2.6s-.3,3.1-.9,5.5l-14.5,56.8c-2.5,9.9-5.3,16.2-8.2,19.1-2.9,2.9-7.8,4.5-14.6,4.9l-1.5,5.4c8.8.1,41.8-.1,46.5-.5,8.7-.7,17.1-2.1,25.1-6.2,8-4.1,14.1-9.3,18.3-15.6,4.1-6.3,6.2-12.9,6.2-20s-.9-8.1-2.7-11.4c-1.8-3.3-4.3-6.1-7.7-8.2-3.3-2.2-7.8-3.7-13.6-4.6,8.3-2.8,14.5-6.8,18.6-12ZM113.9,123.6c2.2,3.1,3.3,6.8,3.3,11.1,0,8.7-2.5,16.9-8.7,23.6-6.4,6.9-9.8,7.9-18.8,9.1-4.2.5-14.1.8-20-.6.9-2,7.9-21.7,10.5-31.8l5-19.7c9.9,0,16.7.6,20.2,1.9,3.5,1.2,6.4,3.4,8.6,6.5Z"/>
<path class="st0" d="M263.1,114.2c-9.5,0-17.7,5.6-24.5,16.9-6.1,9.9-9.1,19.9-9.1,29.9s.9,8.6,2.6,10.8c1.8,2.2,4.3,3.4,7.6,3.4,11.1,0,28.3-15,29.5-16.3,1.1-1.3.9-2.3.4-2.9-.5-.6-1.7-.8-2.7-.2-1,.7-10.5,7.4-13.5,8.8-2.3,1.1-4.4,1.6-6.3,1.6s-3.5-.7-4.6-2c-1.1-1.3-1.6-3.6-1.6-6.9s.2-4.7.6-7.2c8.9-4,14.7-6.8,17.4-8.3,5.4-3.2,9.2-6.2,11.3-9.2,2.1-2.9,3.2-5.9,3.2-9s-.9-5.2-2.6-6.8c-1.8-1.7-4.3-2.5-7.6-2.5ZM259.3,134.7c-3.8,3.9-9.4,7.5-17,10.9.9-5.3,2.4-10.6,4.6-15.7,1.5-3.5,3.3-6.1,5.5-7.9,1.6-1.3,3.3-2,5.1-2s3.1.6,4.1,1.8c1.1,1.2,1.6,2.8,1.6,4.8s-1.3,5.4-3.9,8.1Z"/>
<g xmlns="http://www.w3.org/2000/svg">
<path class="st0" d="M53.8,234.7h-2.7s-2.4-6.1-2.4-6.1h-7.6l-2.4,6.1h-2.5s8.4-20.1,8.4-20.1h.6l8.6,20.1ZM47.9,226.8l-3.2-8.4-3.1,8.4h6.3Z"/>
<path class="st0" d="M78.4,234.7h-3.1s-7.2-10-7.2-10v10h-2.4v-19.5h7c1.4,0,2.5.6,3.3,1.7.9,1.1,1.3,2.3,1.3,3.7s-.1,1.4-.4,2.1c-.2.6-.7,1.2-1.2,1.7-.6.5-1.3.9-2.1,1.1h-2.5s7.2,9.3,7.2,9.3ZM73.2,217.5c-.2,0-.5-.2-.7-.2-.2,0-.5,0-.7,0h-3.6v6.6h4.2c.8,0,1.5-.3,1.9-.9.5-.6.7-1.3.7-2.2s-.2-1.3-.5-1.9c-.3-.6-.8-1-1.4-1.3Z"/>
<path class="st0" d="M103.3,217.2h-5.5v17.5h-2.4v-17.5h-5.5v-2.1h13.3v2.1Z"/>
<path class="st0" d="M123.4,234.7h-2.2v-19.5h-2.2v19.5Z"/>
<path class="st0" d="M153.6,218.5l-2,1c-.2-.8-.6-1.5-1.4-2-.7-.5-1.5-.8-2.4-.8s-1.2.1-1.7.4c-.5.3-.9.7-1.2,1.3-.2.5-.3,1-.3,1.5,0,1.2.5,2.1,1.6,2.7l4.9,1.8c.9.5,1.6,1.2,2,2.1.5.9.7,1.8.7,2.8s-.2,1.7-.5,2.4c-.3.8-.8,1.5-1.5,2.1-1.2.9-2.5,1.3-4,1.3s-2.6-.3-3.7-1c-.6-.5-1.1-1-1.4-1.5-.3-.6-.6-1.3-.9-2.2l2.1-1.1c0,1.1.4,2,1.2,2.8.8.7,1.7,1.1,2.7,1.1s.8,0,1.2-.2c.4-.1.8-.3,1.2-.6.4-.3.7-.7.9-1.2.2-.5.3-1,.3-1.6,0-.8-.2-1.5-.6-1.9-.4-.4-.7-.7-.9-.8-.2-.1-.6-.4-1.3-.7l-3.3-1.2c-1-.5-1.8-1.1-2.4-1.9-.6-.8-.9-1.7-.9-2.8s0-.7.2-1.4c.1-.7.5-1.4,1.2-2.2s1.4-1.2,2.3-1.4c.8-.2,1.5-.3,2.2-.3s.5,0,.6,0,.6,0,1.2.2c.6.1,1.3.5,2.1,1.1.7.6,1.2,1.4,1.5,2.4Z"/>
<path class="st0" d="M182.4,234.7h-2.7s-2.4-6.1-2.4-6.1h-7.6l-2.4,6.1h-2.5s8.4-20.1,8.4-20.1h.6l8.6,20.1ZM176.5,226.8l-3.2-8.4-3.1,8.4h6.3Z"/>
<path class="st0" d="M208.1,235.1h-.5l-13.9-15.7v15.3h-2.1v-20h.5s13.8,15.7,13.8,15.7v-15.2h2.2v20Z"/>
<path class="st0" d="M255.3,234.7h-9.4v-19.5h2.4v17.4h7v2.1Z"/>
<path class="st0" d="M284.5,215.1v13.3c0,1.2-.4,2.3-1,3.3-.6,1.1-1.5,1.9-2.5,2.4-1.4.7-2.9,1-4.4,1s-2.9-.3-4.1-1c-1.2-.7-2-1.5-2.4-2.4-.4-.9-.7-1.6-.8-2.1-.1-.5-.2-.9-.2-1.3v-13.2h2.3v13.2c.1.9.4,1.7.8,2.5.4.7,1,1.3,1.7,1.7,1,.4,1.9.6,2.9.6s1.5-.1,2.1-.4c.7-.3,1.2-.6,1.7-1.2.5-.5.8-1.1,1.1-1.6.2-.5.4-1.1.4-1.6v-13.2h2.3Z"/>
<path class="st0" d="M311,235.1h-.5l-13.9-15.7v15.3h-2.1v-20h.5s13.8,15.7,13.8,15.7v-15.2h2.2v20Z"/>
<path class="st0" d="M333.1,234.7h-10.3v-19.5h10.3v2.1h-8v5.8h8v2h-8v7.5h8v2.1Z"/>
<path class="st0" d="M360.5,217.2h-5.5v17.5h-2.4v-17.5h-5.5v-2.1h13.3v2.1Z"/>
<path class="st0" d="M380.6,234.7h-2.2v-19.5h2.2v19.5Z"/>
<path class="st0" d="M410.3,234.7h-10.3v-19.5h10.3v2.1h-8.1v5.8h8.1v2h-8.1v7.5h8.1v2.1Z"/>
<path class="st0" d="M438.6,234.7h-3.1s-7.2-10-7.2-10v10h-2.4v-19.5h7c1.4,0,2.5.6,3.3,1.7.9,1.1,1.3,2.3,1.3,3.7s-.1,1.4-.4,2.1c-.2.6-.7,1.2-1.2,1.7-.6.5-1.3.9-2.1,1.1h-2.5s7.2,9.3,7.2,9.3ZM433.3,217.5c-.2,0-.5-.2-.7-.2-.2,0-.5,0-.7,0h-3.6v6.6h4.2c.8,0,1.5-.3,1.9-.9.5-.6.7-1.3.7-2.2s-.2-1.3-.5-1.9c-.3-.6-.8-1-1.4-1.3Z"/>
<g xmlns="http://www.w3.org/2000/svg">
<g>
<path class="st0" d="M172.1,95.2h-2.6s-2.4-5.7-2.4-5.7h-7.3l-2.4,5.7h-2.4s8.1-19,8.1-19h.6l8.3,19ZM166.5,87.8l-3.1-8-3,8h6.1Z"/>
<path class="st0" d="M195.1,78.7h-5.3v16.5h-2.3v-16.5h-5.3v-1.9h12.9v1.9Z"/>
<path class="st0" d="M218.5,95.2h-10v-18.4h10v2h-7.8v5.5h7.8v1.9h-7.8v7.1h7.8v2Z"/>
<path class="st0" d="M242.8,95.2h-9.1v-18.4h2.3v16.4h6.8v2Z"/>
<path class="st0" d="M264.5,95.2h-2.2v-18.4h2.2v18.4Z"/>
<path class="st0" d="M293.2,95.2h-10v-18.4h10v2h-7.8v5.5h7.8v1.9h-7.8v7.1h7.8v2Z"/>
<path class="st0" d="M320.6,95.2h-3s-6.9-9.4-6.9-9.4v9.4h-2.3v-18.4h6.8c1.3,0,2.4.6,3.2,1.6s1.3,2.2,1.3,3.5-.1,1.3-.4,1.9c-.2.6-.6,1.1-1.2,1.6-.6.5-1.3.9-2,1.1h-2.4s6.9,8.7,6.9,8.7ZM315.6,79c-.2,0-.4-.2-.7-.2-.2,0-.5,0-.7,0h-3.5v6.2h4.1c.8,0,1.4-.3,1.9-.8.4-.6.7-1.2.7-2s-.2-1.3-.4-1.8c-.3-.5-.7-.9-1.3-1.2Z"/>
</g>
<path class="st0" d="M328.3,45.2l-1.7-1.5c-2.2-1.9-4.5-2.7-7-2.3-2,.3-3.9,1.4-5.6,2.4-.3.2-.7.4-1,.6-1.4.8-3.4,2.1-4.8,4.2-1.4,2.2-3,3.2-5.3,3.6-1.3.2-3.1.2-5,0h-.7c-1.1,0-2.3,0-3.6.2-2.4.4-4.6,1.1-7,2-.8.3-1.5.4-2.2.4-2.3,0-4.8-1-8-3.4-2.3-1.8-4.6-2.3-7-2.7-2-.3-4.6-2.1-7.8-5.2-1.7-1.6-3.2-4-4.8-6.4-.6-.9-1.2-1.9-1.9-2.8-.4-.6-.9-1.3-1.3-1.9-1.4-1.9-2.8-4-4-6.1-.8-1.6-2.3-4.2-4.8-3.8-1.6.3-2.6,1.6-3.4,2.8,0,0-.4.2-.6.3-.5.2-1,.5-1.6.9-.4.3-.7.6-1.2.8-1.3.9-2.9,2-3.9,4-1.1,2.2-1.9,4.6-2.8,7-.5,1.5-1,3-1.6,4.4-.6,1.4-1.1,2-1.2,2-.5.2-1.3.3-2.1.4-.5,0-1.1,0-1.6.2-.6.1-1.2.3-1.7.5,0,0,0,0,0,0-.3-.3-.8-1.3-1-1.8-.2-.5-.5-1-.7-1.5-1-1.9-3.2-2.9-5.8-2.9-.4,0-.7,0-1.1.1-1.7.3-3.1,1.1-4,2.2-.9,1.2-1.7,1.9-2.3,2.3-.6.3-1.3.7-1.9,1.1-1.9,1.1-4,2.3-5.8,2.4-.9,0-2.9-1.2-4.7-3.3-.3-.4-.6-.8-1-1.2-1.6-2-3.6-4.6-7.2-4.5-.3,0-.7,0-1.1.1l-1.1.2c-4.9.8-10.2,1.8-15.3,4.9-.5.3-1.1.5-1.9.6-.6,0-1.1.1-1.8.2-.6,0-1.4.1-2.1.2-1.5.2-3,.5-4.5.8-1.5.3-3.1.6-4.7.8-2.5.4-4.5.6-6.4.7-.7,0-1.4.1-2.2.2-2.2.3-4.2,1-6.2,1.8-1.1.4-2.4,1.3-2,3.2.7,2,2.6,1.3,3.6,1.2,1.9-.7,3.4-1.2,5.2-1.5.6,0,1.1-.1,1.7-.2,2-.1,4.2-.4,6.9-.8,1.6-.3,3.2-.6,4.8-.8,1.4-.3,2.9-.5,4.4-.8.6,0,1.2-.1,1.8-.2.7,0,1.4-.1,2.1-.2,1.4-.2,2.6-.6,3.6-1.2,4.4-2.6,9.1-3.5,13.6-4.3l1.1-.2c1.5-.2,2.2.4,4,2.7h0c.3.5.7.9,1,1.3,1.3,1.5,4.6,5,8.2,4.9h.2c.3,0,.7,0,1-.1,2.5-.4,4.7-1.7,6.9-2.9h0c.6-.4,1.1-.7,1.7-1,1.3-.7,2.5-1.8,3.8-3.6,0,0,.4-.3,1-.4.2,0,.3,0,.5,0,.9,0,1.6.3,1.7.5.2.4.4.8.6,1.2.9,1.9,2.3,4.9,5.7,4.4.3,0,.7-.2,1.1-.3.5-.2,1.3-.3,2-.3.5,0,1,0,1.6-.2.7-.1,1.4-.3,1.9-.5,2-.8,3.2-3.3,3.8-4.6.6-1.5,1.2-3.1,1.7-4.6h0c.7-2.3,1.5-4.5,2.5-6.4.4-.9,1.3-1.5,2.4-2.2.5-.3.9-.6,1.4-1,.1,0,.4-.2.6-.3.7-.3,1.7-.8,2.5-1.9.1.2.2.4.4.6,1.3,2.4,2.8,4.6,4.3,6.7.4.6.9,1.2,1.3,1.8.6.9,1.2,1.8,1.8,2.7,1.7,2.5,3.4,5.1,5.4,7.1,4,3.9,7.2,5.9,10.2,6.4,2.1.4,3.5.7,5.1,1.8,2.5,1.9,6.4,4.4,10.9,4.3.5,0,1,0,1.5-.1.7-.1,1.4-.3,2.1-.5,2.2-.8,4.2-1.5,6.2-1.8,1-.2,1.8-.2,2.6-.2h.7c2,.1,4.2.2,5.9-.1,3.6-.6,6.3-2.4,8.5-5.7.7-1,1.7-1.9,3.2-2.7.4-.2.8-.4,1.1-.7,1.4-.8,2.7-1.6,3.9-1.8.1,0,.3,0,.5,0,.9,0,1.8.4,2.8,1.3l1.7,1.6c5.4,4.9,14.8,12.5,16.4,13.4,1.4.7,2.4.3,2.9-.3.5-.6.8-1.8,0-2.8s-10.9-9.1-16.3-13.9Z"/>
<g>
<rect class="st0" x="37" y="195.5" width="401.7" height="1.8"/>
<path class="st0" d="M439.1,197.7H36.6v-2.6h402.4v2.6ZM37.3,197h401v-1.1H37.3v1.1Z"/>
</g>
<path class="st0" d="M229.9,226.4c0,1.8-1.5,3.3-3.3,3.3s-3.3-1.5-3.3-3.3,1.5-3.3,3.3-3.3,3.3,1.5,3.3,3.3Z"/>
</g>
</g>
</svg>
</a></div><div class="headerTexts"><h1 class="title">Studio Berecllo - By S.B</h1><div class="subTitleSmall">Configuration monture • rendu photo-réaliste</div></div></header><div class="page"><div class="wrap"><div class="grid"><div class="card"><div class="viewer" id="viewer"><div id="cvWrap"><canvas id="cv" width="2048" height="1265"></canvas></div><div class="model-label" id="modelLabel">—</div><div class="loader-overlay" id="loaderOverlay"><div class="spinner"></div></div></div><div class="toolbar"><button class="btn3d" id="btnFav">❤ Favoris</button><button class="btn3d" id="btnShare">⇪ Partager</button><button class="btn3d" id="btnExport">⬇ Exporter</button></div><p class="note" id="driveNote">...</p></div><aside class="side"><div class="panel"><div class="panelHeader"><h2>Faces</h2></div><div id="galFaces" class="gal"></div></div><div class="panel"><div class="panelHeader"><h2>Branches</h2></div><div id="galTemples" class="gal"></div></div><div class="panel"><div class="panelHeader"><h2>Favoris</h2></div><div id="galFavs" class="gal"></div></div></aside></div></div></div><div class="signature">Sébastien BOURDON<br>sb.optic1@gmail.com<br>06&nbsp;62&nbsp;71&nbsp;27&nbsp;52<div class="legal">© 2025 — Usage individuel uniquement</div></div><div id="toast" class="toast">⭐ Ajouté aux favoris</div><script>const DRIVE={API_KEY:"AIzaSyAGTWwPZRyT6P8G2FlfeCRPnlADalQmE-0",FACES_FOLDER_ID:"1sYQqBv9T_CFFeJBS_9otKVz6Q1HONoBx",TEMPLES_FOLDER_ID:"1Uorpg-crCvjlAsYq4Lky2yGRxV2iWwEf",WORKER_URL:"https://berecllo-proxy1.sb-optic1.workers.dev",FACE_MASK_FILE_ID:"1kPVvpTxjyyYZhivVWLrgtG8yHzc8Qrj5",DIRECT_FALLBACK:true,CONCURRENCY:3};const cv=document.getElementById('cv'),ctx=cv.getContext('2d',{willReadFrequently:true}),cvWrap=document.getElementById('cvWrap'),modelLabel=document.getElementById('modelLabel'),viewer=document.getElementById('viewer'),galFaces=document.getElementById('galFaces'),galTemples=document.getElementById('galTemples'),galFavs=document.getElementById('galFavs'),btnFav=document.getElementById('btnFav'),btnShare=document.getElementById('btnShare'),btnExport=document.getElementById('btnExport'),driveNote=document.getElementById('driveNote'),toast=document.getElementById('toast'),loaderOverlay=document.getElementById('loaderOverlay');const state={faces:[],temples:[],selFace:null,selTemples:null,favs:[],tol:60,zoomScale:1.0,dbReady:false,dbFailed:false,pendingDownloads:0};let db;const DB_NAME='berecllo-store',DB_VER=5;function openDB(){return new Promise((res,rej)=>{try{const req=indexedDB.open(DB_NAME,DB_VER);req.onupgradeneeded=e=>{const d=e.target.result;if(d.objectStoreNames.contains('images'))d.deleteObjectStore('images');d.createObjectStore('images',{keyPath:'id'});if(!d.objectStoreNames.contains('meta'))d.createObjectStore('meta',{keyPath:'key'})};req.onsuccess=()=>{db=req.result;state.dbReady=true;res(db)};req.onerror=()=>{state.dbFailed=true;rej(req.error)}}catch(e){state.dbFailed=true;rej(e)}})}function idFor(t,n){return `${t}|${n}`}function putImageRecord(t,n,b,m,th,tc){if(state.dbFailed||!state.dbReady||!db)return Promise.resolve();const tx=db.transaction('images','readwrite');tx.objectStore('images').put({id:idFor(t,n),name:n,type:t,blob:b,modified:m||null,thumbDataURL:th||null,textColor:tc||null});return new Promise(r=>tx.oncomplete=r)}function deleteImageRecord(t,n){if(state.dbFailed||!state.dbReady||!db)return Promise.resolve();const tx=db.transaction('images','readwrite');tx.objectStore('images').delete(idFor(t,n));return new Promise(r=>tx.oncomplete=r)}function getAllImages(){if(state.dbFailed||!state.dbReady||!db)return Promise.resolve([]);return new Promise((res,rej)=>{const tx=db.transaction('images','readonly'),r=tx.objectStore('images').getAll();r.onsuccess=()=>res(r.result||[]);r.onerror=()=>rej(r.error)})}function saveMeta(k,v){if(state.dbFailed||!state.dbReady||!db)return Promise.resolve();const tx=db.transaction('meta','readwrite');tx.objectStore('meta').put({key:k,value:v});return new Promise(r=>tx.oncomplete=r)}function loadMeta(k){if(state.dbFailed||!state.dbReady||!db)return Promise.resolve(null);return new Promise(res=>{const tx=db.transaction('meta','readonly'),r=tx.objectStore('meta').get(k);r.onsuccess=()=>res(r.result?r.result.value:null);r.onerror=()=>res(null)})}function breathe(){return new Promise(r=>setTimeout(r,0))}function imgFromBlob(b){return new Promise((res,rej)=>{const i=new Image();i.onload=()=>res(i);i.onerror=rej;i.src=URL.createObjectURL(b)})}function faceLabel(n){return n.replace(/\.[^.]+$/,'').toUpperCase()}function templesLabel(n){return n.replace(/\.[^.]+$/,'').toLowerCase()}function slugifyForFilename(s){return(s||'berecllo').normalize('NFD').replace(/[\u0300-\u036f]/g,'').replace(/[^\w\- ]+/g,'').replace(/\s+/g,'_').replace(/_+/g,'_').replace(/^_+|_+$/g,'')}function apiDownloadURL(id){return"https://drive.google.com/uc?export=download&id="+encodeURIComponent(id)}function proxyURL(u){return DRIVE.WORKER_URL+"?u="+encodeURIComponent(u)}function apiListURL(id){const q=new URLSearchParams({key:DRIVE.API_KEY,q:`'${id}' in parents and trashed=false`,fields:"files(id,name,mimeType,modifiedTime)",pageSize:1000});return"https://www.googleapis.com/drive/v3/files?"+q.toString()}async function fetchJSONfallback(u){try{const r=await fetch(proxyURL(u),{mode:"cors",headers:{"Content-Type":"application/json"},cache:"no-store"});if(!r.ok)throw new Error("proxy json "+r.status);return await r.json()}catch(e){if(!DRIVE.DIRECT_FALLBACK)throw e;const r2=await fetch(u,{mode:"cors",cache:"no-store"});if(!r2.ok)throw new Error("direct json "+r2.status);return await r2.json()}}async function fetchBLOBfallback(u){try{const r=await fetch(proxyURL(u),{mode:"cors",cache:"no-store"});if(!r.ok)throw new Error("proxy blob "+r.status);return await r.blob()}catch(e){if(!DRIVE.DIRECT_FALLBACK)throw e;const r2=await fetch(u,{mode:"cors",cache:"no-store"});if(!r2.ok)throw new Error("direct blob "+r2.status);return await r2.blob()}}let faceMaskImg=null,faceMaskReady=false,maskLoadingPromise=null;function loadFaceMaskFromDrive(){if(!DRIVE.FACE_MASK_FILE_ID)return;maskLoadingPromise=new Promise(async(res)=>{try{const b=await fetchBLOBfallback(apiDownloadURL(DRIVE.FACE_MASK_FILE_ID));faceMaskImg=await imgFromBlob(b);faceMaskReady=true}catch(e){console.warn("Mask fail",e)}res()})}function removeBackgroundAuto(img,tol){const w=img.naturalWidth||img.width,h=img.naturalHeight||img.height;if(faceMaskReady&&faceMaskImg){const c=document.createElement('canvas');c.width=w;c.height=h;const x=c.getContext('2d');x.clearRect(0,0,w,h);x.drawImage(img,0,0,w,h);x.globalCompositeOperation='destination-in';x.drawImage(faceMaskImg,0,0,w,h);x.globalCompositeOperation='source-over';const o=new Image();o.src=c.toDataURL('image/png');return o}const c=document.createElement('canvas');c.width=w;c.height=h;const x=c.getContext('2d',{willReadFrequently:true});x.drawImage(img,0,0);const d=x.getImageData(0,0,w,h),da=d.data,m=Math.floor(Math.min(w,h)*0.03),st=10;let r=0,g=0,b=0,n=0;function p(sx,sy){const o=(sy*w+sx)*4;r+=da[o];g+=da[o+1];b+=da[o+2];n++}for(let i=0;i<=st;i++){const t=Math.floor(i*(w-1)/st),u=Math.floor(i*(h-1)/st);p(t,m);p(t,h-1-m);p(m,u);p(w-1-m,u)}r/=n;g/=n;b/=n;for(let i=0;i<da.length;i+=4){const dr=da[i]-r,dg=da[i+1]-g,db=da[i+2]-b;if(Math.sqrt(dr*dr+dg*dg+db*db)<tol)da[i+3]=0}x.putImageData(d,0,0);const out=new Image();out.src=c.toDataURL('image/png');return out}async function getProcessedFace(f,tol,prio){if(f.proc)return f.proc;if(!faceMaskReady&&maskLoadingPromise)await maskLoadingPromise;if(!prio)await breathe();const out=removeBackgroundAuto(f.img,tol);await new Promise(r=>out.onload=r);f.proc=out;return out}function makeThumbInfo(img){const S=120,c=document.createElement('canvas');c.width=S;c.height=S;const x=c.getContext('2d',{willReadFrequently:true}),iw=img.naturalWidth||img.width,ih=img.naturalHeight||img.height,ar=iw/ih;let sx,sy,sw,sh;if(ar>1){sh=ih;sw=ih;sx=(iw-sw)/2;sy=0}else{sw=iw;sh=iw;sx=0;sy=(ih-sh)/2}x.drawImage(img,sx,sy,sw,sh,0,0,S,S);const d=x.getImageData(0,0,S,S).data;let r=0,g=0,b=0,n=0;for(let i=0;i<d.length;i+=4){r+=d[i];g+=d[i+1];b+=d[i+2];n++}const l=0.299*(r/n)+0.587*(g/n)+0.114*(b/n);return{thumbDataURL:c.toDataURL('image/jpeg',0.6),textColor:l<140?'#fff':'#000'}}function updateLabel(){const f=state.selFace?faceLabel(state.selFace.name):'',t=state.selTemples?templesLabel(state.selTemples.name):'';modelLabel.textContent=(f&&t)?`${f} - ${t}`:(f||t||'—')}async function redraw(){let ip=false;if(state.selFace&&!state.selFace.proc){ip=true;loaderOverlay.classList.add('active');await getProcessedFace(state.selFace,state.tol,true)}ctx.clearRect(0,0,cv.width,cv.height);if(state.selTemples?.img)ctx.drawImage(state.selTemples.img,0,0,cv.width,cv.height);if(state.selFace?.proc)ctx.drawImage(state.selFace.proc,0,0,cv.width,cv.height);updateLabel();persistSelection().catch(()=>{});if(ip)loaderOverlay.classList.remove('active')}function selectAndRedraw(isF,o){if(isF)state.selFace=o;else state.selTemples=o;redraw();rebuildAllGalleries()}async function processFaceQueue(){while(true){const next=state.faces.find(f=>!f.proc&&(state.selFace!==f));if(!next)break;await breathe();await getProcessedFace(next,state.tol,false);await breathe()}}async function removeVariant(isF,n){const l=isF?state.faces:state.temples,i=l.findIndex(x=>x.name===n);if(i>=0){l.splice(i,1);if(isF&&state.selFace?.name===n)state.selFace=null;if(!isF&&state.selTemples?.name===n)state.selTemples=null}await deleteImageRecord(isF?'face':'temples',n);await persistLists();redraw();rebuildAllGalleries()}function buildThumbEl(isF,o){const w=document.createElement('div');w.className='thumb';w.setAttribute('aria-selected',(isF?state.selFace===o:state.selTemples===o)?'true':'false');const b=document.createElement('div');b.className='thumbInnerBorder';w.appendChild(b);const d=document.createElement('div');d.className='thumbImg';if(o.thumbDataURL)d.style.backgroundImage=`url("${o.thumbDataURL}")`;else d.style.backgroundColor='#f0f0f0';w.appendChild(d);const l=document.createElement('div');l.className='thumbLabel';l.style.color=o.textColor||'#000';l.textContent=isF?faceLabel(o.name):templesLabel(o.name);w.appendChild(l);const c=document.createElement('div');c.className='thumbClose';c.textContent='✕';c.onclick=e=>{e.stopPropagation();removeVariant(isF,o.name)};w.appendChild(c);w.onclick=()=>selectAndRedraw(isF,o);return w}function sortList(l){l.sort((a,b)=>a.name.localeCompare(b.name,undefined,{numeric:true,sensitivity:'base'}))}function rebuildGallery(dom,l,isF){sortList(l);dom.innerHTML='';l.forEach(o=>dom.appendChild(buildThumbEl(isF,o)))}async function renderFavs(){galFavs.innerHTML='';for(const f of state.favs){const fo=state.faces.find(x=>x.name===f.face),to=state.temples.find(x=>x.name===f.temples),w=document.createElement('div');w.className='thumb';w.setAttribute('aria-selected','false');const b=document.createElement('div');b.className='thumbInnerBorder';w.appendChild(b);const d=document.createElement('div');d.className='thumbImg';if(fo&&to&&fo.img&&to.img){const c=document.createElement('canvas');c.width=300;c.height=185;const x=c.getContext('2d');x.drawImage(to.img,0,0,300,185);x.drawImage(fo.proc||fo.img,0,0,300,185);d.style.backgroundImage=`url("${c.toDataURL()}")`}else if(fo&&fo.thumbDataURL)d.style.backgroundImage=`url("${fo.thumbDataURL}")`;else d.style.backgroundColor='#ccc';w.appendChild(d);const l=document.createElement('div');l.className='thumbLabel';l.style.color='#000';l.textContent=f.label;w.appendChild(l);w.onclick=()=>{if(fo)state.selFace=fo;if(to)state.selTemples=to;redraw();rebuildAllGalleries()};galFavs.appendChild(w)}}function rebuildAllGalleries(){rebuildGallery(galFaces,state.faces,true);rebuildGallery(galTemples,state.temples,false);renderFavs()}function toastMsg(t){toast.textContent=t;toast.classList.add('show');setTimeout(()=>toast.classList.remove('show'),1400)}btnExport.onclick=()=>cv.toBlob(b=>{const a=document.createElement('a');a.href=URL.createObjectURL(b);a.download=slugifyForFilename(modelLabel.textContent)+'.png';a.click()});btnShare.onclick=()=>cv.toBlob(async b=>{const f=new File([b],slugifyForFilename(modelLabel.textContent)+'.png',{type:'image/png'});if(navigator.canShare?.({files:[f]}))try{await navigator.share({files:[f],title:'Berecllo'})}catch(e){}});btnFav.onclick=async()=>{if(!state.selFace||!state.selTemples)return;const l=modelLabel.textContent;if(state.favs.find(x=>x.face===state.selFace.name&&x.temples===state.selTemples.name))return;state.favs.unshift({face:state.selFace.name,temples:state.selTemples.name,label:l});if(state.favs.length>5)state.favs.pop();await saveMeta('favs',state.favs);renderFavs();toastMsg('⭐ Ajouté')};async function persistLists(){await saveMeta('facesNames',state.faces.map(x=>x.name));await saveMeta('templesNames',state.temples.map(x=>x.name))}async function persistSelection(){await saveMeta('selection',{face:state.selFace?.name,temples:state.selTemples?.name})}async function processInBatches(l,s,fn){for(let i=0;i<l.length;i+=s){const b=l.slice(i,i+s);await Promise.all(b.map(fn));await breathe()}}async function syncFolder(t,id,prio){let files=[];try{const j=await fetchJSONfallback(apiListURL(id));files=j.files||[]}catch(e){console.warn("List fail",t);return}const list=t==='face'?state.faces:state.temples,rn=new Set(files.map(f=>f.name||(f.id+".png")));let hd=false;for(let i=list.length-1;i>=0;i--){if(!rn.has(list[i].name)){const dn=list[i].name;list.splice(i,1);deleteImageRecord(t,dn);hd=true}}if(hd)rebuildAllGalleries();let td=files.filter(f=>{const n=f.name||(f.id+".png"),x=list.find(i=>i.name===n);return!x||x.modified!==f.modifiedTime});state.pendingDownloads+=td.length;udn();if(prio){td.sort((a,b)=>{const na=a.name||(a.id+".png");if(na===prio)return-1;return 1})}await processInBatches(td,DRIVE.CONCURRENCY,async f=>{const n=f.name||(f.id+".png");try{const b=await fetchBLOBfallback(apiDownloadURL(f.id));await integrateDriveFile(t,n,b,f.modifiedTime);if(t==='face')rebuildGallery(galFaces,state.faces,true);else rebuildGallery(galTemples,state.temples,false)}catch(e){console.warn("DL error",n)}state.pendingDownloads--;udn()});await persistLists()}function udn(){if(state.pendingDownloads>0)driveNote.textContent=`Chargement ${state.pendingDownloads}...`;else driveNote.textContent=""}async function integrateDriveFile(t,n,b,m){const i=await imgFromBlob(b),{thumbDataURL:th,textColor:tc}=makeThumbInfo(i),e={name:n,img:i,proc:null,modified:m,thumbDataURL:th,textColor:tc};if(t==='face'){const x=state.faces.findIndex(i=>i.name===n);if(x>=0)state.faces[x]=e;else state.faces.push(e);if(state.selFace?.name===n){state.selFace=e;redraw()}}else{const x=state.temples.findIndex(i=>i.name===n);if(x>=0)state.temples[x]=e;else state.temples.push(e);if(state.selTemples?.name===n){state.selTemples=e;redraw()}}putImageRecord(t,n,b,m,th,tc).catch(()=>{})}async function reloadFromIndexedDB(){const all=await getAllImages().catch(()=>[]),fn=await loadMeta('facesNames')||[],tn=await loadMeta('templesNames')||[],sel=await loadMeta('selection')||{};state.favs=await loadMeta('favs')||[];const m={};for(const r of all)m[idFor(r.type,r.name)]=r;for(const n of fn){const r=m[idFor('face',n)];if(!r)continue;const i=await imgFromBlob(r.blob);state.faces.push({name:n,img:i,proc:null,modified:r.modified,thumbDataURL:r.thumbDataURL,textColor:r.textColor})}for(const n of tn){const r=m[idFor('temples',n)];if(!r)continue;const i=await imgFromBlob(r.blob);state.temples.push({name:n,img:i,modified:r.modified,thumbDataURL:r.thumbDataURL,textColor:r.textColor})}let pf=null,pt=null;if(sel.face){state.selFace=state.faces.find(x=>x.name===sel.face);if(!state.selFace)pf=sel.face}if(sel.temples){state.selTemples=state.temples.find(x=>x.name===sel.temples);if(!state.selTemples)pt=sel.temples}rebuildAllGalleries();redraw();return{pf,pt}}viewer.addEventListener('wheel',e=>{e.preventDefault();state.zoomScale+=(e.deltaY<0?0.1:-0.1);state.zoomScale=Math.min(Math.max(state.zoomScale,1.0),2.5);cvWrap.style.transform=`scale(${state.zoomScale})`},{passive:false});(async function boot(){await openDB().catch(console.error);loadFaceMaskFromDrive();const{pf,pt}=await reloadFromIndexedDB();processFaceQueue();Promise.all([syncFolder('face',DRIVE.FACES_FOLDER_ID,pf),syncFolder('temples',DRIVE.TEMPLES_FOLDER_ID,pt)]).then(()=>{console.log("Synchro terminée");processFaceQueue()})})();</script></body></html>
